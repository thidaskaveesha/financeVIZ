financeVIZ – Secure Backend (AUTH Module)
=========================================

Program Name
------------

**financeVIZ**

Program Description
-------------------

financeVIZ is a financial visualization platform that helps users understand their financial growth or loss through secure data processing and visualization.This document describes the **AUTH module** for a **secure Node.js backend** using **Supabase (PostgreSQL)** as the database.

Security is a **top priority**. The backend must be designed to prevent client-side tampering, unauthorized access, and data manipulation.

Technology Stack
----------------

*   **Backend:** Node.js
    
*   **Database:** Supabase (PostgreSQL)
    
*   **Authentication:** Custom auth logic (no Supabase Auth)
    
*   **Security:**
    
    *   Password hashing with salt
        
    *   Token-based authentication (JWT or equivalent secure method)
        
    *   CORS enabled
        
    *   Server-side validation only
        
    *   No trust in frontend-controlled values
        

Database Table – public.user
----------------------------

` create table public.user (
  user_id bigint generated by default as identity not null,
  created_at timestamp with time zone not null,
  username text not null,
  access_token text not null,
  hashed_password text not null,
  salt text not null,
  first_time_login boolean not null,
  subscription_level text not null,
  user_email text not null,
  email_verified boolean not null,
  reset_code bigint null,
  reset_code_expiring_time timestamp with time zone null,
  verify_email_code bigint null,
  verify_email_expiring_time timestamp with time zone null,
  constraint user_pkey primary key (user_id),
  constraint user_id_key unique (user_id),
  constraint user_username_key unique (username)
) TABLESPACE pg_default `

AUTH Module Overview
--------------------

The AUTH module consists of **5 endpoints**:

1.  **Sign-Up**
    
2.  **Login**
    
3.  **Email Verify**
    
4.  **Reset Code Generate**
    
5.  **Reset Code Verify**
    

All endpoints must follow **modern, efficient, and secure authentication practices**.

1\. Sign-Up Endpoint
--------------------

### Input

*   username
    
*   email
    
*   password
    

### Flow

1.  Check whether the **username already exists**
    
    *   If yes → return error: **"Username already exists"**
        
2.  Check whether the **email already exists**
    
    *   If yes → return error: **"Email already exists"**
        
3.  Generate a **random salt**
    
4.  Hash the password using the generated salt
    
5.  Generate an **access\_token**
    
    *   Must be created using:username + random numbers + random text
        
    *   Maximum length: **10 characters**
        
6.  Insert user data into the database with:
    
    *   hashed\_password
        
    *   salt
        
    *   access\_token
        
    *   first\_time\_login = true
        
    *   email\_verified = false
        
    *   subscription\_level set server-side only
        

⚠️ Frontend must never control or set subscription\_level.

2\. Login Endpoint
------------------

### Input

*   username OR email
    
*   password
    

### Flow

1.  Check whether the given username or email exists
    
    *   If not → return authentication error
        
2.  Retrieve the user’s stored **salt**
    
3.  Hash the input password using the retrieved salt
    
4.  Compare hashed passwords
    
    *   If mismatch → return authentication error
        
5.  Check email\_verified
    
    *   If false → return error: **"Email not verified"**
        
6.  If valid:
    
    *   Generate a **JWT or equivalent secure token**
        
    *   Token must include server-verified claims
        
    *   subscription\_level must come **only from backend validation**
        
    *   Frontend must not be able to modify user privileges by editing cookies or storage
        

✔️ Even if the user modifies client-side data, backend authorization must remain intact.

3\. Email Verify Endpoint
-------------------------

### Input

*   email
    

### Flow

1.  Check whether the email exists
    
    *   If not → return error
        
2.  Generate an **8-digit random verification code**
    
3.  Set:
    
    *   verify\_email\_code
        
    *   verify\_email\_expiring\_time = current time + 5 minutes
        
    *   Must be stored as timestamp with time zone
        
4.  Send the verification code to the user’s email
    
5.  Once verified successfully:
    
    *   Set email\_verified = true
        
    *   Clear verification code fields if needed
        

4\. Reset Code Generate Endpoint
--------------------------------

### Input

*   username OR email
    

### Flow

1.  Validate that the user exists
    
    *   If not → return error
        
2.  Generate an **8-digit reset code**
    
3.  Save:
    
    *   reset\_code
        
    *   reset\_code\_expiring\_time = current time + 5 minutes
        
4.  Send the reset code to the user’s registered email
    

5\. Reset Code Verify Endpoint
------------------------------

### Input

*   username OR email
    
*   8-digit reset code
    

### Flow

1.  Validate user existence
    
2.  Compare provided reset code with database value
    
3.  Check expiration time
    
    *   If expired → return error
        
4.  If valid → return success response
    
5.  If invalid → return appropriate error response
    

Security & Performance Requirements
-----------------------------------

*   Enable **CORS** with strict allowed origins
    
*   Use **secure password hashing + unique salt per user**
    
*   Use **token-based authentication (JWT or better)**
    
*   Apply **modern search and lookup optimizations** (e.g., Bloom filter–style prechecks or indexed queries)
    
*   Never trust frontend data for:
    
    *   subscription\_level
        
    *   user roles
        
    *   access rights
        
*   All validations must happen **server-side**
    

Goal
----

The AUTH system must be:

*   Secure
    
*   Scalable
    
*   Efficient
    
*   Resistant to tampering
    
*   Designed with real-world attack scenarios in mind